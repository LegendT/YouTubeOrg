---
phase: 11-ux-refinements
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/analysis/final-review.tsx
autonomous: true

must_haves:
  truths:
    - "Final Review dialog has an explicit Cancel button to the left of the Execute button"
    - "Cancel button closes the dialog (same behaviour as X button)"
    - "Cancel button is disabled during execution (isPending state)"
    - "Cancel button is disabled after successful execution"
    - "No double confirmation -- the dialog itself is the confirmation step"
  artifacts:
    - path: "src/components/analysis/final-review.tsx"
      provides: "Cancel + Execute button layout using DialogFooter"
      contains: "DialogFooter"
  key_links:
    - from: "src/components/analysis/final-review.tsx"
      to: "handleOpenChange"
      via: "Cancel button onClick"
      pattern: "Cancel"
---

<objective>
Add an explicit Cancel button to the Final Review & Execute dialog, placed to the left of the Execute button using the standard DialogFooter layout.

Purpose: The Final Review dialog currently only has an Execute button and the X close icon. Users need a discoverable Cancel affordance to close the dialog without executing, following the standard dialog pattern (Cancel left, primary action right).

Output: Modified `final-review.tsx` with DialogFooter containing Cancel + Execute buttons.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-ux-refinements/11-CONTEXT.md
@.planning/phases/11-ux-refinements/11-RESEARCH.md

@src/components/analysis/final-review.tsx
@src/components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Cancel button to Final Review dialog using DialogFooter</name>
  <files>src/components/analysis/final-review.tsx</files>
  <action>
    1. Add `DialogFooter` to the existing Dialog imports at line 5-10:
       ```
       import {
         Dialog,
         DialogContent,
         DialogHeader,
         DialogTitle,
         DialogDescription,
         DialogFooter,
       } from '@/components/ui/dialog'
       ```

    2. Replace the current execution section (lines 290-328, the `<div className="pt-4 space-y-3">` block) with a `DialogFooter`-based layout. The result feedback message should remain ABOVE the footer buttons. The new structure:

       ```
       {/* Result feedback (above footer) */}
       {result && (
         <div
           className={`flex items-center gap-2 text-sm rounded-md p-3 ${
             result.type === 'success'
               ? 'bg-green-50 text-green-800 dark:bg-green-950/20 dark:text-green-200'
               : 'bg-red-50 text-red-800 dark:bg-red-950/20 dark:text-red-200'
           }`}
         >
           {result.type === 'success' ? (
             <CheckCircle className="h-4 w-4 shrink-0" />
           ) : (
             <AlertTriangle className="h-4 w-4 shrink-0" />
           )}
           <span>{result.message}</span>
         </div>
       )}

       <DialogFooter>
         <Button
           variant="outline"
           onClick={() => handleOpenChange(false)}
           disabled={isPending || result?.type === 'success'}
         >
           Cancel
         </Button>
         <Button
           size="lg"
           onClick={handleExecute}
           disabled={approved.length === 0 || isPending || result?.type === 'success'}
         >
           {isPending ? (
             <>
               <Loader2 className="h-4 w-4 mr-2 animate-spin" />
               Executing...
             </>
           ) : result?.type === 'success' ? (
             <>
               <CheckCircle className="h-4 w-4 mr-2" />
               Consolidation saved
             </>
           ) : (
             'Execute consolidation'
           )}
         </Button>
       </DialogFooter>
       ```

    3. The Cancel button:
       - Uses `variant="outline"` (standard secondary action style)
       - Calls `handleOpenChange(false)` which already handles the isPending guard and result cleanup
       - Is disabled during `isPending` (execution in progress) and after success (`result?.type === 'success'`)
       - Does NOT trigger any confirmation -- clicking Cancel simply closes the dialog

    4. Remove the `<Separator />` that was between the Impact section and the old execution div (line 287). The DialogFooter provides its own visual separation. If the Separator is used elsewhere in the component, only remove this specific instance.

    5. Keep the existing `handleOpenChange` function unchanged -- it already prevents closing during isPending and clears result on close.

    NOTE: `DialogFooter` renders as `flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2` which naturally places Cancel to the left of Execute on desktop and stacks them on mobile (with Execute on top for thumb reach). This is the standard pattern already used by `CreateNewCategoryDialog` and `DeleteCategoryDialog` in the project.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify TypeScript compiles. Grep for `DialogFooter` in final-review.tsx. Grep for `Cancel` in final-review.tsx. Run `npm run dev`, navigate to /analysis, approve at least one proposal, click "Review & Execute", and verify the Cancel button appears to the left of Execute.
  </verify>
  <done>
    Final Review dialog has a Cancel button to the left of Execute, using DialogFooter layout. Cancel closes the dialog. Cancel is disabled during execution and after success. No double confirmation pattern -- the dialog itself is the confirmation.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Final Review dialog renders Cancel and Execute buttons in a DialogFooter
3. Cancel button closes dialog via handleOpenChange(false)
4. Cancel button disabled during isPending state
5. Cancel button disabled after successful execution
6. Result feedback message still renders above the buttons
7. Mobile layout stacks buttons correctly (DialogFooter handles this)
</verification>

<success_criteria>
- Cancel button visible to the left of Execute in the Final Review dialog
- Clicking Cancel closes the dialog without executing
- Cancel disabled during execution (cannot close mid-operation)
- Cancel disabled after success (dialog auto-closes after 2s delay via existing onExecute callback)
- Execute button behaviour unchanged from current implementation
- Dialog footer follows the same pattern as other dialogs in the project (CreateNewCategoryDialog, DeleteCategoryDialog)
</success_criteria>

<output>
After completion, create `.planning/phases/11-ux-refinements/11-03-SUMMARY.md`
</output>
