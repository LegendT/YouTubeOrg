---
phase: 11-ux-refinements
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/components/analysis/category-list.tsx
  - src/components/analysis/analysis-dashboard.tsx
autonomous: true

must_haves:
  truths:
    - "Checkboxes in category list rows are used only for batch selection, not approval state"
    - "Approval state is communicated through a coloured left border (green=approved, red=rejected, transparent=pending)"
    - "The inline StatusIcon (Check/X/Circle before category name) is removed from analysis mode rows"
    - "The StatusBadge (text badge on right side) is kept for explicit state confirmation"
    - "A 'Reset' batch operation appears in the BatchToolbar alongside Approve and Reject"
    - "Batch Reset calls bulkUpdateStatus with 'pending' status"
  artifacts:
    - path: "src/components/analysis/category-list.tsx"
      provides: "Visually separated checkbox (batch) from approval state (border + badge)"
      contains: "getStatusBorderClass"
    - path: "src/components/analysis/analysis-dashboard.tsx"
      provides: "BatchToolbar with Reset button alongside Approve/Reject"
      contains: "RotateCcw"
  key_links:
    - from: "src/components/analysis/analysis-dashboard.tsx"
      to: "src/app/actions/analysis.ts"
      via: "bulkUpdateStatus('pending')"
      pattern: "handleBatchAction.*pending"
    - from: "src/components/analysis/category-list.tsx"
      to: "proposal.status"
      via: "getStatusBorderClass"
      pattern: "getStatusBorderClass"
---

<objective>
Visually separate batch-selection checkboxes from approval state indicators in the analysis category list, and add a "Reset" batch operation to the toolbar.

Purpose: Currently the small StatusIcon (Check/X/Circle) next to the category name can be confused with the batch-selection checkbox since both are left-aligned interactive elements. This plan replaces the inline StatusIcon with a coloured left border on each row (green=approved, red=rejected, transparent=pending) and adds "Reset selected" to the batch toolbar. Checkboxes become exclusively for batch operations.

Output: Modified `category-list.tsx` with coloured border approval indicators and no inline StatusIcon, modified `analysis-dashboard.tsx` with Reset button in BatchToolbar.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-ux-refinements/11-CONTEXT.md
@.planning/phases/11-ux-refinements/11-RESEARCH.md
@.planning/phases/11-ux-refinements/11-01-SUMMARY.md

@src/components/analysis/category-list.tsx
@src/components/analysis/analysis-dashboard.tsx
@src/app/actions/analysis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace inline StatusIcon with coloured left border in category-list.tsx</name>
  <files>src/components/analysis/category-list.tsx</files>
  <action>
    Modify the ANALYSIS MODE section of CategoryList (not management mode -- that section is unaffected).

    1. Add a helper function `getStatusBorderClass` near the top of the file (alongside existing helper functions):
       ```
       function getStatusBorderClass(status: string): string {
         switch (status) {
           case 'approved':
             return 'border-l-[3px] border-l-green-500'
           case 'rejected':
             return 'border-l-[3px] border-l-red-500'
           default:
             return 'border-l-[3px] border-l-transparent'
         }
       }
       ```

    2. In the `sortedMain.map(...)` rendering block (around line 534-591), modify each category row `<div>`:
       - ADD the coloured border class: include `${getStatusBorderClass(proposal.status)}` in the className
       - REMOVE the `<StatusIcon status={proposal.status} />` element from within the category name area (the `<div className="flex items-center gap-2">` that contains StatusIcon + name)
       - KEEP the `<StatusBadge status={proposal.status} />` on the right side of each row
       - KEEP the checkbox rendering unchanged (it remains for batch selection only)

    3. In the `sortedReview.map(...)` rendering block (around line 614-676), apply the SAME changes:
       - ADD coloured border class to the row div
       - REMOVE StatusIcon from the name area
       - KEEP StatusBadge on the right
       - KEEP checkboxes

    4. The `StatusIcon` component can remain in the file (it's still used in management mode) but is no longer rendered in analysis mode rows. If it's NOT used in management mode either, you may remove the component definition entirely. Check management mode rendering (it uses `FolderOpen` icon, not StatusIcon) -- if StatusIcon is unused anywhere, remove it.

    5. Do NOT modify the management mode section (the early-return block at the top of the component). It uses FolderOpen icon and has its own styling.

    IMPORTANT: The coloured left border class must be applied to the outermost `<div>` of each row (the one with `data-category-item`). The `border-l-[3px]` sets the width and `border-l-green-500` sets the colour -- both are needed together. If Tailwind v4 has issues with this combination, fall back to inline style: `style={{ borderLeft: '3px solid var(--color)' }}` with appropriate colour variable. Test visually.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify TypeScript compiles. Grep for `getStatusBorderClass` in category-list.tsx. Grep to confirm `StatusIcon` is NOT rendered in analysis mode rows (should not appear between checkbox and category name in the analysis mode JSX). Run `npm run dev` and visually check the /analysis page to confirm coloured borders appear.
  </verify>
  <done>
    Analysis mode category rows show coloured left borders for approval state (green=approved, red=rejected, transparent=pending). The inline StatusIcon is removed from analysis mode rows. StatusBadge remains on the right. Checkboxes are visually distinct from approval state. Management mode is unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Reset button to analysis BatchToolbar</name>
  <files>src/components/analysis/analysis-dashboard.tsx</files>
  <action>
    Modify the `BatchToolbar` component (the analysis mode one around line 699-785, NOT ManagementBatchToolbar):

    1. Add `RotateCcw` to the lucide-react imports at line 696 (alongside existing Check, X).

    2. Change the `handleBatchAction` function signature from accepting `status: 'approved' | 'rejected'` to accepting `status: 'approved' | 'rejected' | 'pending'`. The `bulkUpdateStatus` call already supports 'pending' after Plan 11-01 widened it. Update the feedback label: for 'pending' status, use the label 'reset to pending'.

    3. Add a Reset button in the toolbar button group, placed BEFORE the Reject button (leftmost position since it's the least destructive action):
       ```
       <Button
         size="sm"
         variant="ghost"
         onClick={() => handleBatchAction('pending')}
         disabled={isPending}
       >
         {isPending ? (
           <Loader2 className="h-4 w-4 mr-1.5 animate-spin" />
         ) : (
           <RotateCcw className="h-4 w-4 mr-1.5" />
         )}
         Reset
       </Button>
       ```

    4. The `BatchToolbar` imports `bulkUpdateStatus` from `@/app/actions/analysis` (line 697). After Plan 11-01, `bulkUpdateStatus` already accepts `ProposalStatus` which includes 'pending', so no import changes needed.

    5. Do NOT modify ManagementBatchToolbar -- it only has Merge and Clear buttons and doesn't deal with approval states.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify TypeScript compiles. Grep for `RotateCcw` in analysis-dashboard.tsx. Grep for `handleBatchAction.*pending` to confirm the reset action is wired.
  </verify>
  <done>
    The analysis mode BatchToolbar shows three buttons: Reset (ghost), Reject (outline), Approve (default). Clicking Reset calls `bulkUpdateStatus` with 'pending' status, which clears approvedAt and sets status to pending for all selected proposals.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Category list rows in analysis mode show coloured left borders instead of inline StatusIcon
3. StatusBadge remains visible on the right side of each row
4. Checkboxes are visually distinct from approval state (checkbox = leftmost, border = row edge, badge = right side)
5. BatchToolbar has Reset/Reject/Approve buttons
6. Batch Reset calls bulkUpdateStatus('pending') successfully
7. Management mode category list is unchanged (still uses FolderOpen icon, no coloured borders)
</verification>

<success_criteria>
- Approved rows have green left border, rejected rows have red left border, pending rows have transparent border
- No StatusIcon (Check/X/Circle) appears inline before category names in analysis mode
- StatusBadge text ("Approved"/"Rejected"/"Pending") still shows on right side of each row
- Checkboxes serve batch selection only -- visually and functionally separate from approval state
- "Reset" batch operation in toolbar calls bulkUpdateStatus('pending')
- Management mode rendering is completely untouched
</success_criteria>

<output>
After completion, create `.planning/phases/11-ux-refinements/11-02-SUMMARY.md`
</output>
