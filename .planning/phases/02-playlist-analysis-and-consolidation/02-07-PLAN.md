---
phase: 02-playlist-analysis-and-consolidation
plan: 07
type: execute
wave: 5
depends_on: [02-03, 02-06]
files_modified:
  - src/app/analysis/page.tsx
  - src/components/analysis/analysis-dashboard.tsx
  - src/components/analysis/summary-card.tsx
  - src/components/analysis/category-list.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "User sees resizable split-panel layout with categories on left and detail on right"
    - "User can toggle between horizontal and vertical panel orientation"
    - "User sees analysis summary card showing key stats (playlists, proposed categories, duplicates)"
    - "User sees sortable category list with status badges (Approved, Rejected, Pending)"
    - "User can sort categories by name, video count, source playlist count, or confidence score"
    - "Unmatched/rejected playlists appear in a separate 'Review needed' section"
  artifacts:
    - path: "src/components/analysis/analysis-dashboard.tsx"
      provides: "Top-level client component with resizable split-panel layout and orientation toggle"
      exports: ["AnalysisDashboard"]
      min_lines: 80
    - path: "src/components/analysis/summary-card.tsx"
      provides: "Overview card with key analysis statistics"
      exports: ["SummaryCard"]
      min_lines: 30
    - path: "src/components/analysis/category-list.tsx"
      provides: "Left panel category list with sort, search, status badges, and 'Review needed' section"
      exports: ["CategoryList"]
      min_lines: 120
    - path: "src/app/analysis/page.tsx"
      provides: "Updated analysis page using new AnalysisDashboard component"
      contains: "AnalysisDashboard"
      min_lines: 50
  key_links:
    - from: "src/components/analysis/analysis-dashboard.tsx"
      to: "@/components/ui/resizable"
      via: "ResizablePanelGroup for split layout"
      pattern: "ResizablePanelGroup"
    - from: "src/components/analysis/category-list.tsx"
      to: "src/app/actions/analysis.ts"
      via: "getProposals for category data"
      pattern: "import.*from.*actions/analysis"
    - from: "src/app/analysis/page.tsx"
      to: "src/components/analysis/analysis-dashboard.tsx"
      via: "Server Component passing data to client"
      pattern: "AnalysisDashboard"
---

<objective>
Replace the basic table-based UI from Plan 02-03 with the CONTEXT.md-specified resizable split-panel layout, analysis summary card, and sortable category list with status badges. Install new shadcn/ui components and @tanstack/react-table.

Purpose: CONTEXT.md specifies "Side-by-side panels: Categories list on left, detail panel on right when selected" with toggle layout, alphabetical sort with sort options, separate "Review needed" section, and analysis summary overview card. Plan 02-03's simple table does not meet these requirements.

Output: Resizable split-panel analysis dashboard with left panel showing sortable/searchable category list, summary card, and placeholder right panel ready for detail component (Plan 02-08).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-playlist-analysis-and-consolidation/02-CONTEXT.md
@.planning/phases/02-playlist-analysis-and-consolidation/02-RESEARCH.md
@src/app/analysis/page.tsx
@src/types/analysis.ts
@src/app/actions/analysis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui components and dependencies</name>
  <files>package.json</files>
  <action>
Install all shadcn/ui components and libraries needed for Phase 2 UI (covering this plan and future plans 02-08 through 02-12):

```bash
npx shadcn@latest add resizable table badge progress scroll-area dialog checkbox button separator card tabs
npm install @tanstack/react-table react-hotkeys-hook
```

If shadcn is not yet initialized (no components.json in project root), first run:
```bash
npx shadcn@latest init
```
Accept defaults: TypeScript, App Router, src/ directory, CSS variables for theming.

This installs all UI components needed across remaining plans:
- resizable: Split-panel layout (this plan)
- table: DataTable for video lists (Plan 02-08)
- badge: Status and confidence badges (this plan, 02-08)
- progress: Validation progress bars and review progress (02-08, 02-11)
- scroll-area: Scrollable panels (this plan, 02-08)
- dialog: Split wizard modal (02-10)
- checkbox: Batch selection (02-09)
- button: Actions everywhere
- separator: Section dividers
- card: Summary card, category cards
- tabs: Panel views (optional)

Verify all components installed by checking src/components/ui/ directory.
  </action>
  <verify>
Check components exist:
```bash
ls src/components/ui/ | grep -E "(resizable|table|badge|progress|scroll-area|dialog|checkbox|button|separator|card|tabs)" | wc -l
```
Expected: 11 component files.

Check libraries:
```bash
grep -E "(@tanstack/react-table|react-hotkeys-hook|react-resizable-panels)" package.json
```
Expected: All three in dependencies.
  </verify>
  <done>
All 11 shadcn/ui components installed. @tanstack/react-table, react-hotkeys-hook, and react-resizable-panels in package.json. src/components/ui/ contains all component files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create analysis dashboard layout, summary card, and category list</name>
  <files>src/components/analysis/analysis-dashboard.tsx, src/components/analysis/summary-card.tsx, src/components/analysis/category-list.tsx, src/app/analysis/page.tsx</files>
  <action>
1. **Create src/components/analysis/summary-card.tsx** - Overview card:

```typescript
'use client'

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import type { AnalysisSummary } from '@/types/analysis'

interface SummaryCardProps {
  summary: AnalysisSummary
}

export function SummaryCard({ summary }: SummaryCardProps) {
  return (
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="text-lg">Analysis Overview</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex flex-wrap gap-6 text-sm">
          <div>
            <span className="text-2xl font-bold">{summary.totalPlaylists}</span>
            <span className="text-muted-foreground ml-1">playlists</span>
            <span className="mx-2 text-muted-foreground">→</span>
            <span className="text-2xl font-bold">{summary.proposedCategories}</span>
            <span className="text-muted-foreground ml-1">proposed categories</span>
          </div>
          <div className="text-muted-foreground">
            {summary.duplicatesFound} duplicates found
          </div>
          <div className="text-muted-foreground">
            {summary.approvedCount} approved, {summary.rejectedCount} rejected, {summary.pendingCount} pending
          </div>
        </div>
      </CardContent>
    </Card>
  )
}
```

2. **Create src/components/analysis/category-list.tsx** - Left panel:

This is a Client Component that displays the category list with:
- Search input at top (filter by category name)
- Sort dropdown: Alphabetical (default), Video count, Source playlist count, Confidence score
- Scrollable list of category items using ScrollArea
- Each item shows: category name, video count, status badge (Approved check, Rejected X, Pending circle), confidence badge (color-coded)
- Click handler to select a category (calls onSelect prop)
- Selected item has visual highlight (bg-accent)
- Separate "Review needed" section at bottom for proposals with status='rejected' or confidence level='LOW'
- Use Badge component for status: variant="default" for approved, variant="secondary" for rejected, variant="outline" for pending
- Icons from lucide-react: Check, X, Circle for status; use text color for confidence (green-600, yellow-600, red-600)

Props interface:
```typescript
interface CategoryListProps {
  proposals: ConsolidationProposal[]
  selectedId: number | null
  onSelect: (id: number) => void
}
```

Sort implementation: Use useState for sortField and sortOrder. Sort the proposals array in the component using Array.sort() with the selected field. No need for @tanstack/react-table here (that's for the video list in Plan 02-08).

"Review needed" section: Filter proposals where status === 'rejected' OR (confidence?.level === 'LOW' && status === 'pending'). Display these in a separate section below the main list with a "Review needed" heading.

3. **Create src/components/analysis/analysis-dashboard.tsx** - Split-panel orchestrator:

```typescript
'use client'

import { useState } from 'react'
import {
  ResizablePanelGroup,
  ResizablePanel,
  ResizableHandle,
} from '@/components/ui/resizable'
import { Button } from '@/components/ui/button'
import { LayoutTemplate, Columns, Rows } from 'lucide-react'
import { SummaryCard } from './summary-card'
import { CategoryList } from './category-list'
import type { ConsolidationProposal, AnalysisSummary } from '@/types/analysis'

type Orientation = 'horizontal' | 'vertical'

interface AnalysisDashboardProps {
  proposals: ConsolidationProposal[]
  summary: AnalysisSummary
}

export function AnalysisDashboard({ proposals, summary }: AnalysisDashboardProps) {
  const [orientation, setOrientation] = useState<Orientation>('horizontal')
  const [selectedCategoryId, setSelectedCategoryId] = useState<number | null>(null)

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <SummaryCard summary={summary} />
        <Button
          variant="outline"
          size="sm"
          onClick={() => setOrientation(o => o === 'horizontal' ? 'vertical' : 'horizontal')}
          title={`Switch to ${orientation === 'horizontal' ? 'vertical' : 'horizontal'} layout`}
        >
          {orientation === 'horizontal' ? <Rows className="w-4 h-4" /> : <Columns className="w-4 h-4" />}
        </Button>
      </div>

      <div className="h-[calc(100vh-280px)]">
        <ResizablePanelGroup direction={orientation}>
          <ResizablePanel defaultSize={35} minSize={25}>
            <CategoryList
              proposals={proposals}
              selectedId={selectedCategoryId}
              onSelect={setSelectedCategoryId}
            />
          </ResizablePanel>
          <ResizableHandle withHandle />
          <ResizablePanel defaultSize={65} minSize={30}>
            {selectedCategoryId ? (
              <div className="p-4 text-muted-foreground">
                {/* CategoryDetail component will be added by Plan 02-08 */}
                Category detail for proposal #{selectedCategoryId} — coming in next plan
              </div>
            ) : (
              <div className="flex items-center justify-center h-full text-muted-foreground">
                Select a category to view details
              </div>
            )}
          </ResizablePanel>
        </ResizablePanelGroup>
      </div>
    </div>
  )
}
```

4. **Update src/app/analysis/page.tsx** - Replace simple table with AnalysisDashboard:

The page remains a Server Component. It:
- Imports and calls getProposals(), getAnalysisSummary(), checkStaleness()
- Renders a header with title and "Run Analysis" / "Re-analyze" button (form action calling runAnalysis)
- If stale, shows a warning banner: "Playlist data has changed since last analysis. Re-analyze?"
- If no proposals exist, shows empty state with "Generate Consolidation Proposal" button
- If proposals exist, renders AnalysisDashboard with proposals and summary
- Keep the existing DuplicateReport component (from Plan 02-03) but move it BELOW the dashboard
- REMOVE the old ConsolidationProposalTable from the page layout (replaced by category list in dashboard)
- KEEP the existing imports and PlaylistMerger section if Plan 02-04 added it (but it will be replaced by Plan 02-10's button-based approach)

The page should have:
1. Header with title + "Run Analysis" button (with mode selector dropdown: Conservative/Aggressive)
2. Staleness warning (if applicable)
3. SummaryCard + AnalysisDashboard (if proposals exist)
4. Empty state (if no proposals)

Note: The run analysis button should use a form with hidden input for mode, calling runAnalysis server action. Add a simple dropdown or toggle next to the button for mode selection.
  </action>
  <verify>
Run: `npx tsc --noEmit`

Check new components:
```bash
ls src/components/analysis/ | grep -E "(analysis-dashboard|summary-card|category-list)"
```
Expected: All three files present.

Check resizable import:
```bash
grep "ResizablePanelGroup" src/components/analysis/analysis-dashboard.tsx
```

Check page updated:
```bash
grep "AnalysisDashboard" src/app/analysis/page.tsx
```

Check staleness:
```bash
grep "checkStaleness" src/app/analysis/page.tsx
```
  </verify>
  <done>
SummaryCard displays key analysis stats. CategoryList shows sortable, searchable category list with status/confidence badges and "Review needed" section. AnalysisDashboard wraps both in resizable split-panel with orientation toggle. Analysis page updated to use new dashboard, staleness check, and mode-aware run analysis. All TypeScript compiles.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. **TypeScript compilation clean:** `npx tsc --noEmit`
2. **shadcn/ui components:** ls src/components/ui/ shows all 11 new components
3. **New analysis components:** analysis-dashboard.tsx, summary-card.tsx, category-list.tsx exist
4. **Resizable panels work:** ResizablePanelGroup imported and used
5. **Page updated:** analysis/page.tsx uses AnalysisDashboard
6. **Library dependencies:** @tanstack/react-table, react-hotkeys-hook in package.json

Right panel is a placeholder. Plan 02-08 adds CategoryDetail component.
</verification>

<success_criteria>
Plan complete when:
- All 11 shadcn/ui components installed
- @tanstack/react-table and react-hotkeys-hook installed
- Resizable split-panel layout renders with orientation toggle
- Summary card shows analysis stats
- Category list supports sort (4 options), search, status badges, confidence badges
- "Review needed" section separates rejected/low-confidence proposals
- Analysis page uses new dashboard layout
- Staleness detection warning shown when applicable
- Run analysis button supports mode selection (Conservative/Aggressive)
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-playlist-analysis-and-consolidation/02-07-SUMMARY.md`
</output>
