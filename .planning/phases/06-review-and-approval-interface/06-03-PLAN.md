---
phase: 06-review-and-approval-interface
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/ml-review/review-modal.tsx
  - src/components/ml-review/keyboard-hints.tsx
autonomous: true

must_haves:
  truths:
    - "User can press Enter to open modal for focused video"
    - "User can press A to accept ML suggestion with auto-advance to next"
    - "User can press R to reject ML suggestion with auto-advance to next"
    - "User can press Left/Right arrows to navigate between videos in modal"
    - "User can press Escape to close modal and return to grid"
    - "User sees loading state while fetching video details"
  artifacts:
    - path: "src/components/ml-review/review-modal.tsx"
      provides: "Modal with keyboard-driven accept/reject workflow"
      min_lines: 150
    - path: "src/components/ml-review/keyboard-hints.tsx"
      provides: "Keyboard shortcut legend overlay"
      min_lines: 30
  key_links:
    - from: "ReviewModal"
      to: "@radix-ui/react-dialog"
      via: "Dialog/DialogContent components"
      pattern: "Dialog.*open.*onOpenChange"
    - from: "useHotkeys"
      to: "A/R key handlers"
      via: "accept/reject actions"
      pattern: "useHotkeys.*enabled.*open"
---

<objective>
Create review modal with Radix UI Dialog, keyboard shortcuts (A/R/Left/Right/Escape), auto-advance logic, and lazy-loaded video details.

Purpose: Enables rapid review workflow where user navigates between videos using keyboard, makes accept/reject decisions instantly, and modal auto-advances to next video without closing.

Output: 2 new React components for modal interface and keyboard hints overlay.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-review-and-approval-interface/06-CONTEXT.md
@.planning/phases/06-review-and-approval-interface/06-RESEARCH.md
@src/components/ui/dialog.tsx
@src/types/ml.ts
</context>

<tasks>

<task type="auto">
  <name>Create review modal with keyboard shortcuts</name>
  <files>
    src/components/ml-review/review-modal.tsx
  </files>
  <action>
Create ReviewModal component with Radix Dialog and keyboard shortcuts:

**Props:** open: boolean, videoId: number | null, resultsList: ReviewResult[], onClose: () => void, onNavigate: (videoId: number) => void, onAccept: (videoId: number) => void, onReject: (videoId: number) => void

**State:**
- modalData: VideoReviewDetail | null (fetched via getVideoReviewDetail)
- isLoading: boolean (for fetch state)
- Use useEffect to fetch getVideoReviewDetail(videoId) when open && videoId changes

**Keyboard shortcuts (using react-hotkeys-hook):**
1. **A key:** Accept suggestion
   - useHotkeys('a', handler, { enabled: open && !isLoading, preventDefault: true })
   - Handler: call onAccept(videoId), which triggers auto-advance in parent
2. **R key:** Reject suggestion
   - useHotkeys('r', handler, { enabled: open && !isLoading, preventDefault: true })
   - Handler: call onReject(videoId), which triggers auto-advance in parent
3. **Left arrow:** Navigate to previous video
   - useHotkeys('arrowleft', handler, { enabled: open && !isLoading, preventDefault: true })
   - Handler: Find current index in resultsList, call onNavigate(resultsList[index - 1]?.videoId) if exists
4. **Right arrow:** Navigate to next video
   - useHotkeys('arrowright', handler, { enabled: open && !isLoading, preventDefault: true })
   - Handler: Find current index in resultsList, call onNavigate(resultsList[index + 1]?.videoId) if exists

**Layout (Radix Dialog):**
- Dialog component with open={open} onOpenChange={(isOpen) => !isOpen && onClose()}
- DialogContent with max-w-4xl
- DialogTitle: "Review Video Categorization"
- DialogDescription: "Press A to accept, R to reject, or arrow keys to navigate"

**Modal content (when !isLoading && modalData):**
1. **Video player embed:** iframe with YouTube embed URL (https://www.youtube.com/embed/{modalData.video.youtubeId}), aspect-video, rounded
2. **Video metadata section:** title (text-lg font-semibold), channelTitle (text-sm text-muted-foreground), duration and publishedAt
3. **ML suggestion card:** bg-card p-4 rounded-lg border
   - "Suggested Category: {modalData.suggestedCategory.name}" (text-lg font-medium)
   - Confidence badge: same styling as ReviewCard (color-coded HIGH/MEDIUM/LOW)
   - Similarity score: "{modalData.categorization.similarityScore}% match" (text-sm text-muted-foreground)
4. **Action buttons (also clickable, not just keyboard):**
   - Accept button: onClick calls onAccept, green styling (bg-green-600 text-white)
   - Reject button: onClick calls onReject, red styling (bg-red-600 text-white)
   - Both buttons: px-4 py-2 rounded text-sm font-medium transition-colors

**Loading state:** Show spinner or skeleton UI when isLoading

**Imports:** Dialog, DialogContent, DialogTitle, DialogDescription from @/components/ui/dialog, useHotkeys from react-hotkeys-hook, getVideoReviewDetail from @/app/actions/ml-categorization, VideoReviewDetail from @/types/ml

Pattern: Follow RESEARCH.md Pattern 2 (Auto-Advance After Decision) - onAccept/onReject trigger parent's auto-advance logic, don't close modal.
  </action>
  <verify>
Check component exports and dependencies:
```bash
grep -n "export function ReviewModal" src/components/ml-review/review-modal.tsx
grep -n "useHotkeys" src/components/ml-review/review-modal.tsx
grep -n "@radix-ui/react-dialog" src/components/ml-review/review-modal.tsx
npm run build
```
  </verify>
  <done>
- ReviewModal component created with Radix UI Dialog integration
- A/R keyboard shortcuts trigger accept/reject actions
- Left/Right arrow keys navigate between videos without closing modal
- Auto-advance logic handled via onAccept/onReject callbacks
- YouTube embed iframe for video preview
- Lazy-loaded video details via getVideoReviewDetail
- Loading state shown during fetch
- TypeScript compilation succeeds
  </done>
</task>

<task type="auto">
  <name>Create keyboard shortcuts legend overlay</name>
  <files>
    src/components/ml-review/keyboard-hints.tsx
  </files>
  <action>
Create KeyboardHints component for shortcut reference:

**Props:** None (static display)

**Layout:**
- Outer container: fixed bottom-4 right-4 bg-card border rounded-lg p-4 shadow-lg z-50 (floating overlay in bottom-right corner)
- Title: "Keyboard Shortcuts" (text-sm font-semibold mb-2)
- Shortcuts list: divide-y divide-border
  - Each shortcut: flex items-center justify-between gap-4 py-1.5
  - Left side: Key visual (kbd element with bg-secondary text-secondary-foreground px-2 py-1 rounded text-xs font-mono)
  - Right side: Description (text-xs text-muted-foreground)

**Shortcuts to display:**
- Tab: "Navigate grid"
- Enter: "Open video"
- A: "Accept suggestion"
- R: "Reject suggestion"
- ← →: "Navigate modal"
- Escape: "Close modal"

**Imports:** None (pure UI component)

Pattern: Simple reference card, always visible in bottom-right corner for user guidance.
  </action>
  <verify>
Check component exports:
```bash
grep -n "export function KeyboardHints" src/components/ml-review/keyboard-hints.tsx
npm run build
```
  </verify>
  <done>
- KeyboardHints component created as floating overlay
- Displays 6 keyboard shortcuts with visual key indicators
- Fixed positioning in bottom-right corner
- Uses kbd element for key styling
- TypeScript compilation succeeds
  </done>
</task>

</tasks>

<verification>
1. ReviewModal uses Radix UI Dialog with controlled open state
2. A/R keyboard shortcuts trigger accept/reject actions
3. Left/Right arrows navigate between videos in modal
4. YouTube iframe embeds video for preview
5. Lazy loading implemented via useEffect + getVideoReviewDetail
6. KeyboardHints displays all shortcuts with kbd styling
7. TypeScript compilation succeeds (npm run build)
</verification>

<success_criteria>
- Modal opens with video details when user presses Enter on grid
- A key accepts suggestion and auto-advances to next video
- R key rejects suggestion and auto-advances to next video
- Left/Right arrows navigate modal without closing
- Escape key closes modal (Radix Dialog default behavior)
- Loading state shown during video detail fetch
- Keyboard hints overlay visible for user reference
- All components compile with TypeScript
</success_criteria>

<output>
After completion, create `.planning/phases/06-review-and-approval-interface/06-03-SUMMARY.md`
</output>
