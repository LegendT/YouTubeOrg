---
phase: 13-watch-later-csv-import-metadata-enrichment
plan: 05
type: execute
wave: 5
depends_on: ["13-02", "13-03"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "getDataForCategorisation() returns Watch Later videos alongside other videos"
    - "Watch Later videos have title, channelTitle, and thumbnailUrl fields populated"
    - "Videos with title '[Unavailable Video]' are present but will naturally be skipped by ML (no meaningful embeddings)"
    - "No changes needed to ML categorisation actions or Web Worker code"
  artifacts: []
  key_links:
    - from: "src/app/actions/ml-categorisation.ts"
      to: "src/lib/db/schema.ts"
      via: "SELECT from videos table (no playlist filter — returns all videos)"
      pattern: "from\\(videos\\)"
---

<objective>
Verify that the existing ML categorisation pipeline automatically includes Watch Later videos without any code changes.

Purpose: The ML pipeline must work with imported Watch Later videos for the milestone goal to be achieved. This plan verifies — not implements — that `getDataForCategorisation()` returns Watch Later videos with all required fields. The existing function selects ALL videos from the `videos` table with no playlist filter, so Watch Later videos should appear automatically after import. This plan confirms that assumption and documents any edge cases.

Output: A verification summary confirming ML pipeline integration. No code changes expected.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/13-watch-later-csv-import-metadata-enrichment/13-RESEARCH.md

Key codebase references:
@src/app/actions/ml-categorisation.ts — getDataForCategorisation() (lines 14-60): selects all videos from videos table, no WHERE clause filtering by playlist. Returns id, youtubeId, title, thumbnailUrl, duration, channelTitle, publishedAt.
@src/components/ml/categorisation-trigger.tsx — triggers ML categorisation from UI
@src/lib/db/schema.ts — videos table definition
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify ML pipeline includes Watch Later videos</name>
  <files></files>
  <action>
    This is a VERIFICATION task, not an implementation task. No files should be modified.

    Steps:

    1. Read `src/app/actions/ml-categorisation.ts` and confirm `getDataForCategorisation()`:
       - Selects from the `videos` table with NO WHERE clause filtering by playlist
       - Returns: id, youtubeId, title, thumbnailUrl, duration, channelTitle, publishedAt
       - This means ALL videos in the DB are returned, including Watch Later imports

    2. Verify the required ML fields are populated by the import pipeline:
       - `title`: Set by `fetchVideoBatch()` for available videos, set to `'[Unavailable Video]'` for unavailable
       - `channelTitle`: Set by `fetchVideoBatch()` for available videos, NULL for unavailable
       - `thumbnailUrl`: Set by `fetchVideoBatch()` for available videos, NULL for unavailable

    3. Consider edge cases:
       - Videos with `title: '[Unavailable Video]'` will be included in ML categorisation data. The ML engine computes cosine similarity between video title embeddings and category name embeddings. '[Unavailable Video]' will produce low similarity scores against all categories, so these videos will get LOW confidence categorisations and end up in the manual review queue. This is acceptable behaviour — the user can skip them during review.
       - Videos with NULL channelTitle will not benefit from the channel-name Jaccard boost. This only affects unavailable videos. Acceptable.

    4. Check if `getDataForCategorisation()` has any row limit or pagination that might exclude Watch Later videos. Confirm it does a full table scan (no LIMIT clause).

    5. If ANY issues are found that would prevent Watch Later videos from appearing in the ML pipeline, document them clearly and create a fix. Based on code reading, NO issues are expected.

    6. Write the verification results to the SUMMARY file (the output step below).

    If verification passes (expected): No code changes. Document confirmation.
    If verification fails (unexpected): Create minimal fix and document what was wrong.
  </action>
  <verify>
    Read getDataForCategorisation() source code and confirm:
    - No playlist-based filtering
    - No LIMIT clause
    - Returns all required fields (title, channelTitle, thumbnailUrl)
    - Watch Later videos (stored by 13-02) will be included in the result set
  </verify>
  <done>
    Confirmed: getDataForCategorisation() selects ALL videos from the videos table without filtering. Watch Later videos imported by Plans 13-01 through 13-03 will automatically appear in the ML categorisation pipeline. No code changes required. Unavailable videos will get LOW confidence scores and appear in manual review.
  </done>
</task>

</tasks>

<verification>
1. getDataForCategorisation() has no playlist-based WHERE clause
2. All required ML fields (title, channelTitle, thumbnailUrl) are populated by the import pipeline
3. No row limits that would exclude imported videos
4. Unavailable videos handled gracefully (LOW confidence -> manual review queue)
</verification>

<success_criteria>
- Watch Later videos are confirmed to be included in getDataForCategorisation() results
- All required ML fields are present for available videos
- Unavailable videos are handled gracefully (not blocking, not crashing ML)
- No ML code changes needed (WL-08 acceptance criteria met)
</success_criteria>

<output>
After completion, create `.planning/phases/13-watch-later-csv-import-metadata-enrichment/13-05-SUMMARY.md`
</output>
