---
phase: 10-ui-polish-code-quality
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/layout.tsx
  - src/components/ui/sonner.tsx
  - src/components/videos/video-browse-page.tsx
  - src/components/safety/backup-list.tsx
  - src/components/safety/confirm-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "No alert() calls remain in production code"
    - "No window.confirm() calls remain in production code"
    - "Error feedback for batch operations appears as persistent toast in bottom-right"
    - "Backup restore/delete shows styled modal dialog for confirmation"
    - "ML worker compiles with zero TypeScript errors"
  artifacts:
    - path: "src/components/ui/sonner.tsx"
      provides: "Sonner Toaster wrapper component"
    - path: "src/components/safety/confirm-dialog.tsx"
      provides: "Reusable confirmation dialog for destructive actions"
    - path: "src/app/layout.tsx"
      provides: "Root layout with Toaster provider"
      contains: "Toaster"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/ui/sonner.tsx"
      via: "Toaster import"
      pattern: "import.*Toaster.*sonner"
    - from: "src/components/videos/video-browse-page.tsx"
      to: "sonner"
      via: "toast.error() calls"
      pattern: "toast\\.error"
    - from: "src/components/safety/backup-list.tsx"
      to: "src/components/safety/confirm-dialog.tsx"
      via: "ConfirmDialog usage"
      pattern: "ConfirmDialog"
---

<objective>
Install sonner toast library, replace all alert() calls with toast notifications, replace all window.confirm() calls with styled Radix Dialog confirmation modals, and verify ML worker TypeScript compilation.

Purpose: Eliminate native browser dialogs (alert/confirm) in favour of styled, accessible, consistent UI components. Verify ML worker has zero TS errors.
Output: Sonner toast system wired into root layout, 2 alert() calls replaced with toast.error(), 2 window.confirm() calls replaced with ConfirmDialog component, ML worker verified.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-ui-polish-code-quality/10-CONTEXT.md
@.planning/phases/10-ui-polish-code-quality/10-RESEARCH.md
@src/app/layout.tsx
@src/components/videos/video-browse-page.tsx
@src/components/safety/backup-list.tsx
@src/components/analysis/delete-category-dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install sonner, add Toaster to root layout, replace alert() with toast</name>
  <files>
    src/components/ui/sonner.tsx
    src/app/layout.tsx
    src/components/videos/video-browse-page.tsx
  </files>
  <action>
    1. Install sonner via shadcn CLI: `npx shadcn@latest add sonner` -- this installs the sonner npm package and creates src/components/ui/sonner.tsx wrapper component.

    2. Update src/app/layout.tsx to add the Toaster provider:
       - Import `{ Toaster }` from `@/components/ui/sonner`
       - Add `<Toaster position="bottom-right" richColors expand visibleToasts={100} closeButton toastOptions={{ duration: 3000 }} />` inside the body, after `{children}`

    3. Replace the 2 alert() calls in src/components/videos/video-browse-page.tsx:
       - Add `import { toast } from "sonner"` at top
       - Line ~242: Replace `alert(result.error || 'Failed to move/copy videos')` with `toast.error(result.error || 'Failed to move/copy videos', { duration: Infinity })`
       - Line ~260: Replace `alert(result.error || 'Failed to undo')` with `toast.error(result.error || 'Failed to undo', { duration: Infinity })`
       - Error toasts use `duration: Infinity` (persistent until manually dismissed, per CONTEXT.md)

    4. Remove the `console.error` lines immediately above each replaced alert() call -- the toast makes them redundant.
  </action>
  <verify>
    - `grep -rn "alert(" src/` returns zero matches in production code
    - `npx tsc --noEmit` compiles without errors
    - Dev server starts and toast appears when triggering an error scenario
  </verify>
  <done>
    - Sonner installed and Toaster provider in root layout with bottom-right position, richColors, expand, closeButton, 3s default duration
    - Both alert() calls replaced with toast.error() with duration: Infinity
    - No alert() calls remain in src/
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace window.confirm() with ConfirmDialog, verify ML worker TS</name>
  <files>
    src/components/safety/confirm-dialog.tsx
    src/components/safety/backup-list.tsx
  </files>
  <action>
    1. Create src/components/safety/confirm-dialog.tsx -- a reusable confirmation dialog based on the existing DeleteCategoryDialog pattern (src/components/analysis/delete-category-dialog.tsx):
       - Props: `open: boolean`, `onOpenChange: (open: boolean) => void`, `title: string`, `description: string`, `warning?: string`, `confirmLabel: string`, `variant?: 'default' | 'destructive'`, `onConfirm: () => Promise<void>`, `isPending?: boolean`
       - Uses Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter from @/components/ui/dialog
       - Cancel button (variant="outline") + confirm button (variant from props)
       - Loading state: show Loader2 spinner on confirm button when isPending
       - Warning section: amber bg with AlertTriangle icon when warning prop provided
       - Keep it simple, no internal state for isPending -- let parent control via useTransition

    2. Update src/components/safety/backup-list.tsx to use ConfirmDialog instead of window.confirm():
       - Import ConfirmDialog from './confirm-dialog'
       - Add state: `const [confirmAction, setConfirmAction] = useState<{ type: 'restore' | 'delete'; snapshot: BackupSnapshotMeta } | null>(null)`
       - Replace handleRestore: instead of `window.confirm(...)`, call `setConfirmAction({ type: 'restore', snapshot })`. Move the actual restore logic into a `handleConfirmAction` async function.
       - Replace handleDelete: same pattern -- `setConfirmAction({ type: 'delete', snapshot })`.
       - Add a single `<ConfirmDialog>` at the bottom of the component JSX:
         - `open={confirmAction !== null}`
         - `onOpenChange={(open) => { if (!open) setConfirmAction(null) }}`
         - Title: "Restore Backup" or "Delete Backup" based on confirmAction.type
         - Description: the existing window.confirm message text
         - Warning for restore: "This will replace all current categories and video assignments. A safety backup will be created automatically."
         - confirmLabel: "Restore" or "Delete"
         - variant: 'destructive' for delete, 'default' for restore
         - onConfirm: executes the restore/delete server action, then calls setConfirmAction(null) on success
         - isPending: use the existing `activeAction` state to determine loading

    3. Verify ML worker TypeScript: Run `npx tsc --noEmit` and confirm zero errors. The worker uses `as any` casts (lines 61, 63-64, 66, 171-172 of src/lib/ml/worker.ts) which are functional. No changes needed -- just verify and note in summary.
  </action>
  <verify>
    - `grep -rn "window.confirm" src/` returns zero matches
    - `npx tsc --noEmit` compiles without errors (including ML worker)
    - Dev server starts; visiting /safety and clicking Restore/Delete shows styled dialog (not native browser confirm)
  </verify>
  <done>
    - ConfirmDialog component created with warning display, loading state, cancel/confirm buttons
    - Both window.confirm() calls replaced with ConfirmDialog in backup-list.tsx
    - ML worker verified: zero TypeScript compilation errors
    - No window.confirm() or alert() calls remain in src/
  </done>
</task>

</tasks>

<verification>
- `grep -rn "alert\b\|window\.confirm" src/` returns zero matches
- `npx tsc --noEmit` passes with zero errors
- Dev server runs without errors
- Sonner toast visible in bottom-right when batch operation error occurs
- Backup restore/delete shows styled modal dialog with Cancel + action button
</verification>

<success_criteria>
1. Zero alert() calls in production code -- errors shown via toast
2. Zero window.confirm() calls in production code -- confirmations shown via styled Dialog
3. ml/worker.ts compiles with zero TypeScript errors
4. Toaster provider in root layout with correct configuration (bottom-right, richColors, expand, closeButton, 3s duration)
</success_criteria>

<output>
After completion, create `.planning/phases/10-ui-polish-code-quality/10-01-SUMMARY.md`
</output>
